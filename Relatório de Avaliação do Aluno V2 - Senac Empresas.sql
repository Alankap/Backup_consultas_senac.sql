SELECT   u.id AS "ID do Aluno",   CONCAT (u.firstname, ' ', u.lastname) AS "Nome do Aluno",   c.id AS "ID do Curso",   c.fullname AS "Nome do Curso",   gi.itemname AS "Recurso Avaliativo",   DATE_FORMAT (     FROM_UNIXTIME (gg.timemodified),     '%d/%m/%Y %H:%i:%s'   ) AS "Data da Tentativa",   CASE     WHEN gg.finalgrade IS NULL THEN 'Não iniciado'     WHEN gg.finalgrade IS NOT NULL     AND gg.rawgrademax IS NULL THEN 'Em andamento'     ELSE 'Concluído'   END AS "Status da Avaliação",   COUNT(ga.id) AS "Tentativas",   MAX(CASE WHEN fi.id = 399 THEN fv.value END) AS "Nota Final",   ROUND(gg.rawgrademax, 2) AS "Nota Máxima" FROM   mdl_user u   JOIN mdl_user_enrolments ue ON ue.userid = u.id   JOIN mdl_enrol e ON e.id = ue.enrolid   JOIN mdl_course c ON c.id = e.courseid   JOIN mdl_grade_items gi ON gi.courseid = c.id   LEFT JOIN mdl_grade_grades gg ON gg.itemid = gi.id   AND gg.userid = u.id   LEFT JOIN mdl_assign a ON a.course = c.id   AND gi.iteminstance = a.id   AND gi.itemmodule = 'assign'   LEFT JOIN mdl_assign_grades ag ON ag.assignment = a.id   AND ag.userid = u.id   LEFT JOIN mdl_assign_submission ga ON ga.assignment = a.id   AND ga.userid = u.id   LEFT JOIN mdl_feedback fb ON fb.course = c.id   LEFT JOIN mdl_feedback_completed fc ON fc.feedback = fb.id AND fc.userid = u.id   LEFT JOIN mdl_feedback_value fv ON fv.completed = fc.id   LEFT JOIN mdl_feedback_item fi ON fi.id = fv.item WHERE   c.visible = 1   AND gi.itemtype = 'mod' GROUP BY   u.id,   c.id,   gi.id,   gg.id ORDER BY   "Nome do Curso",   "Nome do Aluno",   "Recurso Avaliativo";
