SELECT   u.id AS "Id do Aluno",   CONCAT(u.firstname, ' ', u.lastname) AS "Nome do Aluno",   CASE     WHEN nascimento.data IS NULL     OR TRIM(nascimento.data) = ''     OR LOWER(TRIM(nascimento.data)) = 'unknown' THEN 'Não Informado'     ELSE nascimento.data   END AS "Data de Nascimento",   CASE     WHEN autoident.data IS NULL     OR TRIM(autoident.data) = ''     OR LOWER(TRIM(autoident.data)) = 'unknown' THEN 'Não Informado'     ELSE autoident.data   END AS "Autoidentificação",   CASE     WHEN etnia.data IS NULL     OR TRIM(etnia.data) = ''     OR LOWER(TRIM(etnia.data)) = 'unknown' THEN 'Não Informado'     ELSE etnia.data   END AS "Etnia",   CASE     WHEN escolaridade.data IS NULL     OR TRIM(escolaridade.data) = ''     OR LOWER(TRIM(escolaridade.data)) = 'unknown' THEN 'Não Informado'     ELSE escolaridade.data   END AS "Escolaridade",   CASE     WHEN empresa.data IS NULL     OR TRIM(empresa.data) = ''     OR LOWER(TRIM(empresa.data)) = 'unknown' THEN 'Não Informado'     ELSE empresa.data   END AS "Empresa",   c.id AS "Id do Curso",   c.fullname AS "Nome do Curso",   cat.name AS "Categoria do Curso",   COALESCE(     NULLIF(TRIM(cfd_carga.value), ''),     'Não Informado'   ) AS "Carga Horária",   FROM_UNIXTIME(MIN(ue.timecreated)) AS "Data de Inscrição",   MIN(FROM_UNIXTIME(l.timecreated)) AS "Primeiro Acesso ao Curso",   MAX(FROM_UNIXTIME(l.timecreated)) AS "Último Acesso ao Curso",   COUNT(l.id) AS "Total de Acessos ao Curso",   CASE     WHEN cc.timecompleted IS NOT NULL THEN 100     ELSE 0   END AS "Percentual de Progresso no Curso" FROM   mdl_user AS u   JOIN mdl_user_enrolments AS ue ON ue.userid = u.id   JOIN mdl_enrol AS e ON e.id = ue.enrolid   JOIN mdl_course AS c ON c.id = e.courseid   JOIN mdl_course_categories AS cat ON cat.id = c.category   LEFT JOIN mdl_logstore_standard_log AS l ON l.userid = u.id   AND l.courseid = c.id   LEFT JOIN mdl_course_completions AS cc ON cc.userid = u.id   AND cc.course = c.id   LEFT JOIN mdl_user_info_field AS f_nascimento ON f_nascimento.shortname = 'nascimento'   LEFT JOIN mdl_user_info_data AS nascimento ON nascimento.userid = u.id   AND nascimento.fieldid = f_nascimento.id   LEFT JOIN mdl_user_info_field AS f_autoident ON f_autoident.shortname = 'sexo'   LEFT JOIN mdl_user_info_data AS autoident ON autoident.userid = u.id   AND autoident.fieldid = f_autoident.id   LEFT JOIN mdl_user_info_field AS f_etnia ON f_etnia.shortname = 'etnia'   LEFT JOIN mdl_user_info_data AS etnia ON etnia.userid = u.id   AND etnia.fieldid = f_etnia.id   LEFT JOIN mdl_user_info_field AS f_escolaridade ON f_escolaridade.shortname = 'escolaridade'   LEFT JOIN mdl_user_info_data AS escolaridade ON escolaridade.userid = u.id   AND escolaridade.fieldid = f_escolaridade.id   LEFT JOIN mdl_user_info_field AS f_empresa ON f_empresa.shortname = 'empresa'   LEFT JOIN mdl_user_info_data AS empresa ON empresa.userid = u.id   AND empresa.fieldid = f_empresa.id   LEFT JOIN mdl_customfield_field AS cff_carga ON cff_carga.shortname = 'carga_horaria'   LEFT JOIN mdl_customfield_data AS cfd_carga ON cfd_carga.fieldid = cff_carga.id   AND cfd_carga.instanceid = c.id WHERE   u.deleted = 0   AND u.suspended = 0   AND NOT EXISTS (     SELECT       1     FROM       mdl_user_info_data AS ud       JOIN mdl_user_info_field AS uf ON uf.id = ud.fieldid     WHERE       ud.userid = u.id       AND uf.shortname = 'obs'       AND ud.data = '0'   ) GROUP BY   u.id,   u.firstname,   u.lastname,   nascimento.data,   autoident.data,   etnia.data,   escolaridade.data,   empresa.data,   ue.timecreated,   c.id,   c.fullname,   cat.name,   cfd_carga.value,   cc.timecompleted ORDER BY   "Nome do Curso",   "Nome do Aluno";
