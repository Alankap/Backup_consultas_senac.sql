SELECT     t.id AS "Id do Departamento",     t.name AS "Nome do Departamento",     c.id AS "Id do Curso",     c.fullname AS "Nome do Curso",     COUNT(DISTINCT CASE         WHEN cc.timecompleted IS NOT NULL THEN u.id     END) AS "Concluídos",     COUNT(DISTINCT CASE         WHEN ue.status = 0 AND cc.timecompleted IS NULL THEN u.id     END) AS "Em Andamento",     COUNT(DISTINCT CASE         WHEN ue.status IS NULL THEN u.id     END) AS "Não Inscritos" FROM     mdl_tool_tenant AS t     JOIN mdl_tool_tenant_user AS tu ON t.id = tu.tenantid     JOIN mdl_user AS u ON u.id = tu.userid     LEFT JOIN mdl_user_enrolments AS ue ON ue.userid = u.id     LEFT JOIN mdl_enrol AS e ON ue.enrolid = e.id     LEFT JOIN mdl_course AS c ON c.id = e.courseid     LEFT JOIN mdl_course_completions AS cc ON cc.userid = u.id AND cc.course = c.id WHERE     u.deleted = 0     AND t.name NOT IN ('No Tenant', 'Saber Senac') GROUP BY     t.id,     t.name,     c.id,     c.fullname ORDER BY     t.name,     c.fullname;
