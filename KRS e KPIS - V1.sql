SELECT     CONCAT('MOODLE KR12VAR1 ', EXTRACT(YEAR FROM FROM_UNIXTIME(cc.timecompleted))) AS "CÓDIGO_ITEM",     CEIL(EXTRACT(MONTH FROM FROM_UNIXTIME(cc.timecompleted)) / 3) AS "PERÍODO",     EXTRACT(YEAR FROM FROM_UNIXTIME(cc.timecompleted)) AS "ANO",     COUNT(DISTINCT u.id) AS "VALOR_REALIZADO",     'MÉTRICA - Docentes com ao menos uma capacitação concluída por trimestre no ano corrente' AS "NOME DO ITEM" FROM     mdl_user u JOIN mdl_course_completions cc ON u.id = cc.userid JOIN mdl_user_info_data uid ON uid.userid = u.id JOIN mdl_user_info_field uif ON uid.fieldid = uif.id WHERE     cc.timecompleted IS NOT NULL     AND uif.shortname = 'docente'     AND uid.data = '1' GROUP BY     CEIL(EXTRACT(MONTH FROM FROM_UNIXTIME(cc.timecompleted)) / 3),     EXTRACT(YEAR FROM FROM_UNIXTIME(cc.timecompleted))  UNION ALL  SELECT     CONCAT('MOODLE KR12VAR2 ', EXTRACT(YEAR FROM FROM_UNIXTIME(u.firstaccess))) AS "CÓDIGO_ITEM",     CEIL(EXTRACT(MONTH FROM FROM_UNIXTIME(u.firstaccess)) / 3) AS "PERÍODO",     EXTRACT(YEAR FROM FROM_UNIXTIME(u.firstaccess)) AS "ANO",     COUNT(DISTINCT u.id) AS "VALOR_REALIZADO",     'MÉTRICA - Total de docentes ativos por trimestre no ano corrente' AS "NOME DO ITEM" FROM     mdl_user u JOIN mdl_user_info_data uid ON uid.userid = u.id JOIN mdl_user_info_field uif ON uid.fieldid = uif.id WHERE     u.firstaccess IS NOT NULL     AND uif.shortname = 'docente'     AND uid.data = '1' GROUP BY     CEIL(EXTRACT(MONTH FROM FROM_UNIXTIME(u.firstaccess)) / 3),     EXTRACT(YEAR FROM FROM_UNIXTIME(u.firstaccess))  UNION ALL  SELECT     CONCAT('MOODLE KR71VAR1 ', ano) AS "CÓDIGO_ITEM",     periodo AS "PERÍODO",     ano AS "ANO",     COUNT(DISTINCT userid) AS "VALOR_REALIZADO",     'MÉTRICA - Líderes com 3+ capacitações concluídas no trimestre no ano corrente' AS "NOME DO ITEM" FROM (     SELECT         u.id AS userid,         CEIL(EXTRACT(MONTH FROM FROM_UNIXTIME(cc.timecompleted)) / 3) AS periodo,         EXTRACT(YEAR FROM FROM_UNIXTIME(cc.timecompleted)) AS ano     FROM         mdl_user u     JOIN mdl_course_completions cc ON u.id = cc.userid     JOIN mdl_user_info_data uid ON uid.userid = u.id     JOIN mdl_user_info_field uif ON uid.fieldid = uif.id     WHERE         cc.timecompleted IS NOT NULL         AND uif.shortname = 'lider'         AND uid.data = '1'     GROUP BY         u.id,         CEIL(EXTRACT(MONTH FROM FROM_UNIXTIME(cc.timecompleted)) / 3),         EXTRACT(YEAR FROM FROM_UNIXTIME(cc.timecompleted))     HAVING         COUNT(DISTINCT cc.course) >= 3 ) AS sub GROUP BY     periodo,     ano  UNION ALL  SELECT     CONCAT('MOODLE KR71VAR2 ', EXTRACT(YEAR FROM FROM_UNIXTIME(u.firstaccess))) AS "CÓDIGO_ITEM",     CEIL(EXTRACT(MONTH FROM FROM_UNIXTIME(u.firstaccess)) / 3) AS "PERÍODO",     EXTRACT(YEAR FROM FROM_UNIXTIME(u.firstaccess)) AS "ANO",     COUNT(DISTINCT u.id) AS "VALOR_REALIZADO",     'MÉTRICA - Total de líderes ativos por trimestre no ano corrente' AS "NOME DO ITEM" FROM     mdl_user u JOIN mdl_user_info_data uid ON uid.userid = u.id JOIN mdl_user_info_field uif ON uid.fieldid = uif.id WHERE     u.firstaccess IS NOT NULL     AND uif.shortname = 'lider'     AND uid.data = '1' GROUP BY     CEIL(EXTRACT(MONTH FROM FROM_UNIXTIME(u.firstaccess)) / 3),     EXTRACT(YEAR FROM FROM_UNIXTIME(u.firstaccess));
