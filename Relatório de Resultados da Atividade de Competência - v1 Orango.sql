SELECT u.id AS "ID do Usuário", CONCAT(u.firstname, ' ', u.lastname) AS "Nome do Aluno", c.id AS "ID do Curso", c.fullname AS "Curso", cm.id AS "ID da Atividade", cmc.completionstate AS "Status da Atividade", CASE WHEN cmc.completionstate = 0 THEN 'Não iniciado' WHEN cmc.completionstate = 1 THEN 'Iniciado' WHEN cmc.completionstate = 2 THEN 'Concluído' ELSE 'Desconhecido' END AS "Descrição", CASE WHEN md.name = 'label' THEN 'Rótulo' WHEN md.name = 'coursecertificate' THEN 'Certificado do Curso' ELSE 'Desconhecido' END AS "Tipo de Atividade", cm.instance AS "Instância da Atividade", cs.id AS "ID da Competência", cs.shortname AS "Nome da Competência", cs.description AS "Descrição da Competência" FROM mdl_user u JOIN mdl_user_enrolments ue ON u.id = ue.userid JOIN mdl_enrol e ON ue.enrolid = e.id JOIN mdl_course c ON e.courseid = c.id LEFT JOIN mdl_course_modules cm ON cm.course = c.id LEFT JOIN mdl_modules md ON cm.module = md.id LEFT JOIN mdl_course_modules_completion cmc ON cmc.coursemoduleid = cm.id AND cmc.userid = u.id LEFT JOIN mdl_competency_modulecomp mc ON mc.cmid = cm.id LEFT JOIN mdl_competency cs ON mc.competencyid = cs.id WHERE c.visible = 1 ORDER BY c.fullname, u.firstname, u.lastname, cm.id;
